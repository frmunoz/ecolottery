<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix 1: basic functions and examples • ecolottery</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 1: basic functions and examples">
<meta property="og:description" content="ecolottery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecolottery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Barro_Colorado.html">`coalesc_abc` function with a site-species matrix: example with Barro-Colorado dataset.</a>
    </li>
    <li>
      <a href="../articles/coalesc_vignette.html">Appendix 1: basic functions and examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/frmunoz/ecolottery/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="coalesc_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix 1: basic functions and examples</h1>
                        <h4 data-toc-skip class="author">François MUNOZ and Pierre DENELLE</h4>
            
            <h4 data-toc-skip class="date">2021-04-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/frmunoz/ecolottery/blob/master/vignettes/coalesc_vignette.Rmd" class="external-link"><code>vignettes/coalesc_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>coalesc_vignette.Rmd</code></div>

    </div>

    
    
<p>This vignette corresponds to the latest version of the Appendix 1 of F. Munoz et al. paper.</p>
<p><em><code><a href="../reference/coalesc.html">coalesc()</a></code></em> is the key function of the <em><code>ecolottery</code></em> package for coalescent-based simulation of local communities. The user can define parameters of community size, migration rate, and a custom function specifying environmental filtering, according to the situation he wants to model. He can also provide relative abundances and species trait values for the regional pool.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div id="neutral-dynamics-in-species-pool-and-communities" class="section level1">
<h1 class="hasAnchor">
<a href="#neutral-dynamics-in-species-pool-and-communities" class="anchor"></a>Neutral dynamics in species pool and communities</h1>
<p>Before simulating communities, we need first to define a reference pool from which immigrants are drawn. In the neutral theory (Hubbell 2001), speciation and extinction events occur randomly irrespective of species properties and drive the composition and species abundances in the reference pool (neutral speciation-drift dynamics). We can define such dynamics by setting the input argument <em><code>theta</code></em> in <em><code>coalesc</code></em> to a non-null value, and the composition of the pool can be simulated by setting <em>m = 1</em>. The simulated species abundances are then expected to follow a logseries distribution (Hubbell 2001). The fit of simulated pool composition to the logseries distribution can be estimated using the <em><code>fisherfit</code></em> function of package <em><code>vegan</code></em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frmunoz/ecolottery" class="external-link">ecolottery</a></span><span class="op">)</span>

<span class="va">Jpool</span> <span class="op">&lt;-</span> <span class="fl">25000</span>
<span class="va">logser</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">Jpool</span>, m <span class="op">=</span> <span class="fl">1</span>, theta <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> 
<span class="va">abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">logser</span><span class="op">)</span> 

<span class="co"># The expected distribution of abundances in the reference pool is log-series</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org" class="external-link">vegan</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: permute</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## This is vegan 2.5-7</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/fisherfit.html" class="external-link">fisherfit</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">ab</span><span class="op">)</span>
<span class="va">freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">fisher</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span>, <span class="va">fit</span><span class="op">$</span><span class="va">fisher</span>, xlab <span class="op">=</span> <span class="st">"Frequency (log)"</span>, ylab <span class="op">=</span> <span class="st">"Species"</span>, type <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">freq</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">freq</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="va">fit</span><span class="op">$</span><span class="va">fisher</span>, col <span class="op">=</span> <span class="st">"skyblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in rect(log(freq - 0.5), 0, log(freq + 0.5), fit$fisher, col =
## "skyblue", : "add" is not a graphical parameter</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">estimate</span>
<span class="va">k</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">nuisance</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">*</span> <span class="va">k</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,
      add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>We now simulate neutral communities of size <em>J = 500</em> in which immigrants from the pool establish at rate either <em>m = 0.01</em> or <em>m = 0.95</em>. In this case, all the species available in the reference pool have the same prospect of immigrating, persisting and reproducing in the local community. We can define such dynamics by setting the input argument <em><code>filt = NULL</code></em> in <em><code><a href="../reference/coalesc.html">coalesc()</a></code></em> (default value).<br>
The smaller is <em>m</em> the more local species abundances fluctuate due to stochastic demographic variations. Where <em>m</em> is close to 1, most of the dead individuals are replaced by immigrants, and local species abundances are then more closely related to regional abundances.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Local abundances are averaged over 100 replicate communities</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>
<span class="va">comm1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">comm1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">comm1a</span>, <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">logser</span><span class="op">$</span><span class="va">com</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">comm1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pool <span class="op">=</span> <span class="va">logser</span><span class="op">$</span><span class="va">com</span>, com <span class="op">=</span> <span class="va">comm1a</span><span class="op">)</span>

<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>
<span class="va">comm1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">comm1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">comm1b</span>, <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">logser</span><span class="op">$</span><span class="va">com</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">comm1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pool <span class="op">=</span> <span class="va">logser</span><span class="op">$</span><span class="va">com</span>, com <span class="op">=</span> <span class="va">comm1b</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm1a</span>, type <span class="op">=</span><span class="st">"locreg"</span>, main <span class="op">=</span> <span class="st">"m = 0.01"</span><span class="op">)</span>
<span class="va">r_sqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1a</span><span class="op">)</span><span class="op">$</span><span class="va">pool</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1a</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">)</span>, <span class="st">"relab"</span><span class="op">]</span> <span class="op">~</span>
                      <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1a</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">relab</span><span class="op">)</span><span class="op">)</span>
<span class="va">r_sqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">r_sqa</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">R</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">"="</span> <span class="op">~</span><span class="fu">.</span> <span class="op">(</span><span class="va">r_sqa</span><span class="op">)</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm1b</span>, type <span class="op">=</span> <span class="st">"locreg"</span>, main <span class="op">=</span> <span class="st">"m = 0.95"</span><span class="op">)</span>
<span class="va">r_sqb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1b</span><span class="op">)</span><span class="op">$</span><span class="va">pool</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1b</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">)</span>, <span class="st">"relab"</span><span class="op">]</span> <span class="op">~</span>
                      <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm1b</span><span class="op">)</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">relab</span><span class="op">)</span><span class="op">)</span>
<span class="va">r_sqb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">r_sqb</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">R</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="st">"="</span> <span class="op">~</span><span class="fu">.</span> <span class="op">(</span><span class="va">r_sqb</span><span class="op">)</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-3-2.png" width="576"></p>
<p>The first figure shows the relationship between local and regional species abundances in neutral communities with low immigration rate, and the second the relationship with a high immigration rate. Each point is averaged over 100 communities.</p>
</div>
<div id="user-defined-species-pool" class="section level1">
<h1 class="hasAnchor">
<a href="#user-defined-species-pool" class="anchor"></a>User-defined species pool</h1>
<p>In the previous case, the composition of the reference pool was simulated depending on the parameter <em>theta</em> of neutral speciation-drift dynamics.<br>
In the following example, the user provides a custom species pool including 500 species with equal abundances.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Jpool</span> <span class="op">&lt;-</span> <span class="fl">50</span><span class="op">*</span><span class="va">J</span>
<span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>,<span class="va">Jpool</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Generate a neutral community drawn from the pool</span>
<span class="va">comm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool<span class="op">=</span><span class="va">pool</span><span class="op">)</span> 
<span class="va">abund2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="va">comm2</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">abund2</span><span class="op">$</span><span class="va">pool</span><span class="op">$</span><span class="va">relab</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.002   0.002   0.002   0.002   0.002   0.002</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">abund2</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">relab</span><span class="op">)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.002000 0.002000 0.002000 0.003185 0.004000 0.012000</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">abund2</span><span class="op">$</span><span class="va">com</span><span class="op">$</span><span class="va">relab</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>While species relative abundances are set equal in the reference pool, local species abundances fluctuate due to migration-drift dynamics.</p>
</div>
<div id="trait-distribution-in-communities" class="section level1">
<h1 class="hasAnchor">
<a href="#trait-distribution-in-communities" class="anchor"></a>Trait distribution in communities</h1>
<p>We can also examine the trait composition of simulated communities. If the user does not provide trait values in the reference pool, the values of a unique trait are randomly assigned to the species of the reference pool following a uniform distribution between 0 and 1. Alternatively, the user can include in <em>pool</em> the values of one or several traits for each individual of the species pool, or provide a separate <em>traits</em> data frame including the values of one or several traits for each species.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With uniform trait values in the species pool</span>
<span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="va">Jpool</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">Jpool</span><span class="op">)</span><span class="op">)</span>
<span class="va">comm3a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span> 
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm3a</span>, type <span class="op">=</span> <span class="st">"trait"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With Gaussian trait values in the species pool</span>
<span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="va">Jpool</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">Jpool</span><span class="op">)</span><span class="op">)</span>
<span class="va">comm3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span> 
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm3b</span>, type<span class="op">=</span><span class="st">"trait"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-5-2.png" width="576"></p>
<p><em><code>plot_comm</code></em> with <em><code>type = "trait"</code></em> here displays the trait distributions in species pool (red) and local community (blue). With high migration probability <em>m = 0.95</em>, the local and regional distributions are quite similar. The user may also simulate a distribution of mean species trait values, and consider additional intraspecific variation of these values around the mean.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, <span class="va">Jpool</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="co"># Distribution of the mean species trait values</span>
<span class="va">t.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span> 
<span class="co"># Gaussian intraspecific variation with standard deviation = 0.01</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span> <span class="va">pool</span><span class="op">[</span><span class="va">pool</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pool</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="va">i</span><span class="op">)</span>, 
                                                mean <span class="op">=</span> <span class="va">t.sp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="va">comm3c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span> </code></pre></div>
</div>
<div id="environmental-filtering" class="section level1">
<h1 class="hasAnchor">
<a href="#environmental-filtering" class="anchor"></a>Environmental filtering</h1>
<p>The user can provide an environmental filtering function weighting the probability that individuals from the reference pool successfully immigrate in the community, depending on their trait value(s). In the following example, the filtering function is Gaussian with mean <em>t</em> and standard deviation 0.1 (stabilizing filtering, Shipley 2013).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">filt_gaussian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>,<span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We simulate a community undergoing stabilizing environmental filtering around <em>t = 0.5</em>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">500</span>; <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; 
<span class="va">comm4a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">x</span><span class="op">)</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm4a</span>, main <span class="op">=</span> <span class="st">"Stabilizing filtering around t = 0.5"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>We can also simulate stabilizing environmental filtering around <em>t = 0.1</em> and <em>t = 0.9</em>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">500</span>; <span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; 
<span class="va">comm4b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">x</span><span class="op">)</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm4b</span>, main <span class="op">=</span> <span class="st">"Stabilizing filtering around t = 0.1"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">comm4c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">x</span><span class="op">)</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm4c</span>, main <span class="op">=</span> <span class="st">"Stabilizing filtering around t = 0.9"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-9-2.png" width="576"></p>
<p>When stabilizing filtering operates around different optimal values among communities, we expect corresponding changes in the local mean trait values (Cornwell and Ackerly 2009).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">comm4b</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.1268257</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">comm4c</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.8639424</code></pre>
<p>Different filtering functions can be designed to represent different types of environmental filtering. By analogy with selection regimes in evolutionary theory (Shipley 2013), we can define the outcome of directional and disruptive filtering functions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Directional environmental filtering toward t = 0</span>
<span class="va">comm4d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">1</span><span class="op">)</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm4d</span>, main <span class="op">=</span> <span class="st">"Directional filtering"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Disruptive environmental filtering around t = 0.5</span>
<span class="va">comm4e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span>, pool <span class="op">=</span> <span class="va">pool</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">comm4e</span>, main <span class="op">=</span> <span class="st">"Disruptive filtering"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-11-2.png" width="576"></p>
<p>Disruptive filtering here represents the greater success of species with trait values away from <em>t = 0.5</em>. It corresponds to a separation of ecological groups in the community, and represents a form of niche differentiation (Vergnon et al. 2009).</p>
</div>
<div id="filtering-of-multiple-traits" class="section level1">
<h1 class="hasAnchor">
<a href="#filtering-of-multiple-traits" class="anchor"></a>Filtering of multiple traits</h1>
<p>Previous examples represented environmental filtering depending on the values of a single trait. It is also possible to define environmental filtering operating on multiple traits. In the following example, three traits have values uniformly distributed between 0 and 1 in the reference pool, and undergo stabilizing filtering in the local community with distinct optimal values, 0.5, 0.25 and 0.75.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># An example with 3 traits</span>
<span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">Jpool</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">Jpool</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">Jpool</span><span class="op">)</span><span class="op">)</span> 
<span class="va">filt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> 
  <span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.25</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.75</span>, <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="va">comm5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10000</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,
                 filt <span class="op">=</span> <span class="va">filt</span>, traits <span class="op">=</span> <span class="va">traits</span><span class="op">)</span></code></pre></div>
<p>The filtering function determines the success of immigrants depending on the combination of their trait values. It entails a correlation between the local species abundances and the species weights given by the filtering function (Shipley et al. 2006).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Relationship between species weight in environmental filtering and local abundance</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">comm5</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, <span class="va">comm5</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">length</span><span class="op">)</span> <span class="op">~</span> 
       <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">comm5</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">filt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="va">comm5</span><span class="op">$</span><span class="va">com</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span>,
     xlab <span class="op">=</span> <span class="st">"Species filtering weight"</span>, ylab <span class="op">=</span> <span class="st">"Species abundance"</span>, log <span class="op">=</span> <span class="st">"xy"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
</div>
<div id="investigating-phylogenetic-structure-in-communities" class="section level1">
<h1 class="hasAnchor">
<a href="#investigating-phylogenetic-structure-in-communities" class="anchor"></a>Investigating phylogenetic structure in communities</h1>
<p>Species trait values are the legacy of evolutionary history. The processes that affect the distribution of trait values in the community can also affect the phylogenetic composition of the community depending, e.g, on the conservatism of traits among close relatives (Mouquet et al. 2012).</p>
<p>We can simulate a phylogenetic tree of the species of the reference pool, and the distribution of species trait values under an assumption of niche conservatism (Wiens and Graham 2005). In this case, descendant species can retain characteristics of their ancestors, and the trait values of more closely related species are then more similar than trait values of distantly related species (phylogenetic signal, Blomberg and Garland 2002).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">picante</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rcoal</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>
<span class="va">Jpool</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ind<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>, sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tre</span><span class="op">$</span><span class="va">tip.label</span>,<span class="va">Jpool</span><span class="op">/</span><span class="fl">50</span><span class="op">)</span>, 
                   tra<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">Jpool</span><span class="op">)</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co"># Brownian model of trait evolution</span>
<span class="va">t.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rTraitCont.html" class="external-link">rTraitCont</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, phy <span class="op">=</span> <span class="va">tre</span>, model <span class="op">=</span> <span class="st">"BM"</span>, sigma <span class="op">=</span> <span class="fl">0.2</span>, root.value <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">pool</span><span class="op">$</span><span class="va">tra</span> <span class="op">&lt;-</span> <span class="va">t.sp</span><span class="op">[</span><span class="va">pool</span><span class="op">$</span><span class="va">sp</span><span class="op">]</span></code></pre></div>
<p><em><code><a href="https://rdrr.io/pkg/picante/man/phylosignal.html" class="external-link">phylosignal()</a></code></em> measures the phylogenetic signal of the simulated trait values in the phylogenetic tree, using the Blomberg’s <em>K</em> statistic (Blomberg and Garland 2002). The p-value is calculated based on the null distribution of <em>K</em> when shuffling species trait values in the phylogeny. A small p-value indicates that trait variation among close relatives is smaller than expected by chance.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/picante/man/phylosignal.html" class="external-link">phylosignal</a></span><span class="op">(</span><span class="va">t.sp</span><span class="op">[</span><span class="va">tre</span><span class="op">$</span><span class="va">tip.label</span><span class="op">]</span>, phy <span class="op">=</span> <span class="va">tre</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">K</th>
<th align="right">PIC.variance.obs</th>
<th align="right">PIC.variance.rnd.mean</th>
<th align="right">PIC.variance.P</th>
<th align="right">PIC.variance.Z</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.4353206</td>
<td align="right">0.0379655</td>
<td align="right">5.597743</td>
<td align="right">0.001</td>
<td align="right">-3.684698</td>
</tr></tbody>
</table>
<p>We then simulate two communities related to this reference pool, one undergoing neutral dynamics, the other undergoing stabilizing environmental filtering. In the first case, any species of the reference pool can perform as well in the local community, and then the phylogenetic structure of the community should not be different from the structure of a random sample with same size from the reference pool. In the second case, environmental filtering limits the range of trait values in the community around an optimal value. Because more closely related species are more likely to have similar trait values in the reference pool, we then expect that the Mean Nearest Taxon Distance (MNTD) among coexisting species of the community is smaller than the average distance in the reference pool (Webb et al. 2002).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tre</span><span class="op">$</span><span class="va">tip.label</span>
<span class="co"># First simulation of a neutral community</span>
<span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span>, filt <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">com</span>
<span class="va">tab</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">com</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">ab</span>
<span class="co"># Second simulation of a community undergoing stabilizing environmental filtering</span>
<span class="va">topt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">t.sp</span>, <span class="fl">0.25</span><span class="op">)</span>
<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>
<span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
                    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">topt</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">com</span>
<span class="va">tab</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">com</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">ab</span></code></pre></div>
<p>These patterns can be tested against a null model of random sampling in the phylogeny. The standard effect size (SES) quantifies the departure of observed phylogenetic structure from the null distribution.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/picante/man/ses.mntd.html" class="external-link">ses.mntd</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>, <span class="va">tre</span><span class="op">$</span><span class="va">tip.label</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cophenetic.html" class="external-link">cophenetic</a></span><span class="op">(</span><span class="va">tre</span><span class="op">)</span>, null.model <span class="op">=</span> <span class="st">"taxa.labels"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Standard Effect Size of Mean Nearest Taxon Distance</caption>
<colgroup>
<col width="7%">
<col width="11%">
<col width="17%">
<col width="15%">
<col width="16%">
<col width="12%">
<col width="12%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">ntaxa</th>
<th align="right">mntd.obs</th>
<th align="right">mntd.rand.mean</th>
<th align="right">mntd.rand.sd</th>
<th align="right">mntd.obs.rank</th>
<th align="right">mntd.obs.z</th>
<th align="right">mntd.obs.p</th>
<th align="right">runs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">188</td>
<td align="right">0.0223628</td>
<td align="right">0.0226298</td>
<td align="right">0.0008848</td>
<td align="right">336</td>
<td align="right">-0.3017737</td>
<td align="right">0.336</td>
<td align="right">999</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">0.0643427</td>
<td align="right">0.2167746</td>
<td align="right">0.0616037</td>
<td align="right">4</td>
<td align="right">-2.4743941</td>
<td align="right">0.004</td>
<td align="right">999</td>
</tr>
</tbody>
</table>
<p>The first community does not depart from random phylogenetic structure, while the second shows phylogenetic structuring, i.e., smaller Mean Nearest Taxon Distance than expected by chance (<em>mntd.obs.p &lt; 0.01</em>).</p>
<p>Alternatively, in the absence of niche conservatism in the phylogeny, environmental filtering in community assembly would not result in phylogenetic clustering. To illustrate this case, we shuffle the trait values of species in the reference pool, and simulate a new local community with stabilizing environmental filtering.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">t.sp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">t.sp</span><span class="op">)</span><span class="op">)</span>
<span class="va">pool</span><span class="op">$</span><span class="va">tra</span> <span class="op">&lt;-</span> <span class="va">t.sp</span><span class="op">[</span><span class="va">pool</span><span class="op">$</span><span class="va">sp</span><span class="op">]</span>
<span class="co"># Again simulating stabilizing environmental filtering</span>
<span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abund.html">abund</a></span><span class="op">(</span><span class="fu"><a href="../reference/coalesc.html">coalesc</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">m</span>, pool <span class="op">=</span> <span class="va">pool</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> 
                        <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">topt</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">com</span>
<span class="va">tab</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">com</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">ab</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/picante/man/ses.mntd.html" class="external-link">ses.mntd</a></span><span class="op">(</span><span class="va">tab</span><span class="op">[</span>,<span class="va">tre</span><span class="op">$</span><span class="va">tip.label</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cophenetic.html" class="external-link">cophenetic</a></span><span class="op">(</span><span class="va">tre</span><span class="op">)</span>, null.model <span class="op">=</span> <span class="st">"taxa.labels"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Standard Effect Size of Mean Nearest Taxon Distance</caption>
<colgroup>
<col width="7%">
<col width="11%">
<col width="17%">
<col width="15%">
<col width="16%">
<col width="12%">
<col width="12%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">ntaxa</th>
<th align="right">mntd.obs</th>
<th align="right">mntd.rand.mean</th>
<th align="right">mntd.rand.sd</th>
<th align="right">mntd.obs.rank</th>
<th align="right">mntd.obs.z</th>
<th align="right">mntd.obs.p</th>
<th align="right">runs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">188</td>
<td align="right">0.0223628</td>
<td align="right">0.0226819</td>
<td align="right">0.0008646</td>
<td align="right">320</td>
<td align="right">-0.3690727</td>
<td align="right">0.320</td>
<td align="right">999</td>
</tr>
<tr class="even">
<td align="right">35</td>
<td align="right">0.0598282</td>
<td align="right">0.1208284</td>
<td align="right">0.0291028</td>
<td align="right">12</td>
<td align="right">-2.0960266</td>
<td align="right">0.012</td>
<td align="right">999</td>
</tr>
</tbody>
</table>
<p>In this case, neither the neutral community nor the community with environmental filtering shows phylogenetic clustering. Therefore, when the condition of niche conservatism is not met, the absence of phylogenetic clustering does not mean that environmental filtering does not play (Mouquet et al. 2012).</p>
</div>
<div id="forward-in-time-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#forward-in-time-simulation" class="anchor"></a>Forward-in-time simulation</h1>
<p>The <em>ecolottery</em> package also includes a function <em>forward</em> to perform simulation of community dynamics from an initial composition. As for <em>coalesc</em>, the user can define the composition of the species pool from which immigrants are drawn, and can specify environmental filtering based on one or several traits.</p>
<p>We can for instance simulate stabilizing environmental filtering in a way analogous to the previous example with <em><code><a href="../reference/coalesc.html">coalesc()</a></code></em>. <em><code>d = 10</code></em> represents the number of individuals that die in the community at each time step, <em><code>prob = 0.5</code></em> represents the immigration rate at each time step. The number of simulated time steps is <em><code>gens = 500</code></em>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"pool"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">Jpool</span>, sep<span class="op">=</span><span class="st">"."</span><span class="op">)</span>, sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span>,<span class="va">Jpool</span><span class="op">/</span><span class="fl">500</span><span class="op">)</span>, 
                   tra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">Jpool</span><span class="op">)</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="va">t.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span>, tra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>
<span class="va">pool</span><span class="op">$</span><span class="va">tra</span> <span class="op">&lt;-</span> <span class="va">t.sp</span><span class="op">[</span><span class="va">pool</span><span class="op">$</span><span class="va">sp</span>,<span class="op">]</span><span class="op">$</span><span class="va">tra</span>
<span class="co"># Initial community composed of 500 individuals</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"init"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">J</span>, sep<span class="op">=</span><span class="st">"."</span><span class="op">)</span>, sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,<span class="va">J</span><span class="op">/</span><span class="fl">50</span><span class="op">)</span>, 
                   tra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">J</span><span class="op">)</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="va">initial</span><span class="op">$</span><span class="va">tra</span> <span class="op">&lt;-</span> <span class="va">t.sp</span><span class="op">[</span><span class="va">initial</span><span class="op">$</span><span class="va">sp</span>,<span class="op">]</span><span class="op">$</span><span class="va">tra</span>
<span class="co"># Forward-in-time simulation </span>
<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">filt_gaussian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>,<span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">final.envfilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forward.html">forward</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="va">initial</span>, m <span class="op">=</span> <span class="fl">0.25</span>, d <span class="op">=</span> <span class="fl">10</span>, gens <span class="op">=</span> <span class="fl">500</span>, 
                         pool <span class="op">=</span> <span class="va">pool</span>, filt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">filt_gaussian</span><span class="op">(</span><span class="fl">0.5</span>,<span class="va">x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_comm.html">plot_comm</a></span><span class="op">(</span><span class="va">final.envfilt</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
<p>A specific advantage of <code><a href="../reference/forward.html">forward()</a></code> is to simulate the sequence of community assembly events over time. If the birth, death and immigration probabilities depend on community composition at a specific time, the coalescent-based approach may not be appropriate.</p>
<p>In the following example, community dynamics with limiting similarity are simulated. In this case, the probability of individual death depends on the similarity of trait values of each individual to the other individuals of the community.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">final.limsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forward.html">forward</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="va">initial</span>, m <span class="op">=</span> <span class="fl">0.25</span>, d <span class="op">=</span> <span class="fl">10</span>, gens <span class="op">=</span> <span class="fl">1000</span>,
                 pool <span class="op">=</span> <span class="va">pool</span>, keep <span class="op">=</span> <span class="cn">F</span>, limit.sim <span class="op">=</span> <span class="cn">T</span>, coeff.lim.sim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.limsim</span><span class="op">$</span><span class="va">dist.t</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Average distance to other individuals"</span><span class="op">)</span>
<span class="va">init.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">initial</span><span class="op">$</span><span class="va">tra</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">init.dist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">init.dist</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="fl">0</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final.limsim</span><span class="op">$</span><span class="va">sp_t</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Richness"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">initial</span><span class="op">$</span><span class="va">sp</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="coalesc_vignette_files/figure-html/unnamed-chunk-27-2.png" width="576"></p>
<p>The first figure represents the temporal trajectory of the average distance of each individual to the other individuals of the community. The distance fluctuates and increases over time due to the influence of limiting similarity. The second figure shows the variation of richness, basically decreasing due to limiting similarity, until reaching stationarity.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Blomberg, S. P., Garland Jr, T., &amp; Ives, A. R. (2003). Testing for phylogenetic signal in comparative data: behavioral traits are more labile. <strong>Evolution</strong>, 57(4), 717-745.</p>
<p>Cornwell, W. K., &amp; Ackerly, D. D. (2009). Community assembly and shifts in plant trait distributions across an environmental gradient in coastal California. <strong>Ecological Monographs</strong>, 79(1), 109-126.</p>
<p>Hubbell, S.P. (2001). <strong>A Unified Neutral Theory of Biodiversity and Biogeography</strong>. Princeton University Press, Princeton, NJ.</p>
<p>Mouquet, N., Devictor, V., Meynard, C. N., Munoz, F., Bersier, L. F., Chave, J., … &amp; Hardy, O. J. (2012). Ecophylogenetics: advances and perspectives. <strong>Biological reviews</strong>, 87(4), 769-785.</p>
<p>Shipley, B., Vile, D., &amp; Garnier, E. (2006). From plant traits to plant communities: a statistical mechanistic approach to biodiversity. <strong>Science</strong>, 314(5800), 812-814.</p>
<p>Shipley, B. (2013). <strong>From plant traits to vegetation structure: chance and selection in the assembly of ecological communities</strong>. Cambridge University Press.</p>
<p>Vergnon, R., Dulvy, N.K. &amp; Freckleton, R.P. (2009). Niches versus neutrality: Uncovering the drivers of diversity in a species-rich community. <strong>Ecology Letters</strong>, 12, 1079-1090.</p>
<p>Wiens, J. J., &amp; Graham, C. H. (2005). Niche conservatism: integrating evolution, ecology, and conservation biology. <strong>Annu. Rev. Ecol. Evol. Syst.</strong>, 36, 519-539.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by François Munoz, Matthias Grenié, Pierre Denelle, Elizabeth Barthelemy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
