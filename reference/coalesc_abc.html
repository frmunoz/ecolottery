<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimation of neutral and non-neutral parameters of community assembly using
  Approximate Bayesian Computation (ABC), — coalesc_abc • ecolottery</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimation of neutral and non-neutral parameters of community assembly using
  Approximate Bayesian Computation (ABC), — coalesc_abc" />
<meta property="og:description" content="Estimates parameters of neutral migration-drift dynamics (through migration
  rate m and parameters of environmental filtering (through a filtering function
  filt.abc()) from the composition of a local community and the related
  regional pool." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecolottery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Barro_Colorado.html">`coalesc_abc` function with a site-species matrix: example with Barro-Colorado dataset.</a>
    </li>
    <li>
      <a href="../articles/coalesc_vignette.html">Appendix 1: basic functions and examples</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/frmunoz/ecolottery/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimation of neutral and non-neutral parameters of community assembly using
  Approximate Bayesian Computation (ABC),</h1>
    
    <div class="hidden name"><code>coalesc_abc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates parameters of neutral migration-drift dynamics (through migration
  rate m and parameters of environmental filtering (through a filtering function
  <code>filt.abc()</code>) from the composition of a local community and the related
  regional pool.</p>
    </div>

    <pre class="usage"><span class='fu'>coalesc_abc</span>(<span class='no'>comm.obs</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"single"</span>, <span class='kw'>prop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>traits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>f.sumstats</span>, <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,  <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>migr.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>size.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>par.size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>dim.pca</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>svd</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>theta.max</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>nb.core</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"standard"</span>, <span class='kw'>method.seq</span> <span class='kw'>=</span> <span class='st'>"Lenormand"</span>, <span class='kw'>method.mcmc</span> <span class='kw'>=</span> <span class='st'>"Marjoram_original"</span>,
  <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"rejection"</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

  <span class='fu'>coalesc_abc_std</span>(<span class='no'>comm.obs</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"single"</span>, <span class='kw'>prop</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>traits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>f.sumstats</span>, <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>migr.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>size.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='no'>F</span>,
  <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>par.size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>constr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>dim.pca</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>svd</span> <span class='kw'>=</span> <span class='no'>F</span>,
  <span class='kw'>theta.max</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>nb.core</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>tol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"rejection"</span>)

  <span class='fu'>do.simul.coalesc</span>(<span class='no'>J</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"single"</span>, <span class='kw'>prop</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>nb.com</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>traits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>migr.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>size.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>constr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>dim.pca</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>svd</span> <span class='kw'>=</span> <span class='no'>F</span>,
  <span class='kw'>theta.max</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>nb.core</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>tol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"rejection"</span>)

  <span class='fu'>generate_prior</span>(<span class='kw'>pool</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>prop</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>constr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>theta.max</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>)

  <span class='fu'>initial_checks</span>(<span class='kw'>comm.obs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"single"</span>, <span class='kw'>prop</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>traits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>migr.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>size.abc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>add</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,  <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>par.size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>constr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>dim.pca</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>svd</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>theta.max</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='no'>F</span>, <span class='kw'>nb.core</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"standard"</span>, <span class='kw'>method.seq</span> <span class='kw'>=</span> <span class='st'>"Lenormand"</span>, <span class='kw'>method.mcmc</span> <span class='kw'>=</span> <span class='st'>"Marjoram_original"</span>,
  <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"rejection"</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>comm.obs</th>
      <td><p>the observed community composition. If <code>multi = "single"</code> (default),
    should be a matrix or data.frame of individuals on rows with their
    individual id (first column), and species id (second column).</p></td>
    </tr>
    <tr>
      <th>pool</th>
      <td><p>composition of the regional pool to which the local community is
    hypothesized to be related through migration dynamics with possible
    environmental filtering. Should be a matrix of individuals on rows with
    their individual id (first column), species id (second column), and
    (optionally) the trait values of the individuals.
    When <code>multi = "tab"</code> or <code>"seqcom"</code>, different pools can be 
    set for each community: <code>pool</code> must be then defined as a list of 
    matrices with the same columns as above.</p></td>
    </tr>
    <tr>
      <th>multi</th>
      <td><p>structure of the community inputs:</p><ul>
<li><p>if <code>multi = "single"</code>, <code>comm.obs</code> represents a single
      community</p></li>
<li><p>if <code>multi = "tab"</code>, the user provides a site-species matrix
      (<strong>sites in rows and species in columns</strong>)</p></li>
<li><p>if <code>multi = "seqcom"</code>, <code>comm.obs</code> contains a list of
      communities</p></li>
</ul><p></p></td>
    </tr>
    <tr>
      <th>prop</th>
      <td><p>indicates if the community composition is given in term of relative species abundances, 
    cover or proportions. In this case, a parameter of effective community size is estimated.
    Presently only available with multi = "tab". Default is FALSE. If no prior is provided for
    <code>J</code>, it is by default a uniform distribution between 100 and 1000.</p></td>
    </tr>
    <tr>
      <th>traits</th>
      <td><p>the trait values of species in the regional pool. It is used if trait
    information is not provided in <code>pool</code>. In this case, intraspecific
    trait variation is assumed to be null. Species names of <code>pool</code> must
    be included in <code>traits</code>.</p></td>
    </tr>
    <tr>
      <th>f.sumstats</th>
      <td><p>a function allowing to calculate the summary statistics of local community
    composition. Will be used to compare observed and simulated community
    composition in the ABC estimation. It should return a vector of summary statistics.
    There must be at least one input, i.e., the local community composition with individual and 
    species labels as first columns and (optionally) trait values as subsequent columns. 
    There can be a second argument taking the average trait values per species (derived from <code>pool</code>
    if not provided in <code>traits</code>, see above), and <code>var.add</code> (see below) can be sent 
    as a third argument. See examples of different options below.</p></td>
    </tr>
    <tr>
      <th>filt.abc</th>
      <td><p>the hypothesized environmental filtering function. It is a function of
    individual trait values (first argument), additional parameters to be estimated and (optionally) 
    environmental variables defined in <code>var.add</code>.
    If <code>NULL</code>, neutral communities will be simulated and only m will be estimated.</p></td>
    </tr>
    <tr>
      <th>filt.vect</th>
      <td><p>indicates whether the filtering function can be vectorized. It means that the function
    can take as input a vector of trait values and provide a vector of the corresponding 
    weights.</p></td>
    </tr>
    <tr>
      <th>migr.abc</th>
      <td><p>a function defining immigration probability in local communities. It can be a function of 
    environmental variables defined in <code>var.add</code> and of parameters to be estimated.</p></td>
    </tr>
    <tr>
      <th>size.abc</th>
      <td><p>a function defining local community sizes. It can be used when <code>prop = T</code>.
    It can be a function of environmental variables defined in <code>var.add</code> and of 
    parameters to be estimated.</p></td>
    </tr>
    <tr>
      <th>add</th>
      <td><p>indicates if additional variables must be passed to <code>filt.abc</code> and/or <code>migr.abc</code>
    . It can be, for instance, environmental data conditioning the trait-based filtering 
    and/or immigration in the community. Default is FALSE.</p></td>
    </tr>
    <tr>
      <th>var.add</th>
      <td><p>additional variables to be passed to <code>filt.abc</code> and/or <code>migr.abc</code> 
    when <code>add = T</code>.</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>equivalent to par.filt (see below): it is kept in the function for compatibility with 
    previous versions.</p></td>
    </tr>
    <tr>
      <th>par.filt</th>
      <td><p>a matrix of the bounds of the parameters used in <code>filt.abc</code>. The row
    names of <code>par.filt</code> provide the parameter names used in ABC calculation
    and output. First column contains minimum values and second column contains
    maximum values.</p></td>
    </tr>
    <tr>
      <th>par.migr</th>
      <td><p>a matrix of the bounds of the parameters used in <code>migr.abc</code>. The row
    names of <code>par.migr</code> provide the parameter names used in ABC calculation
    and output. First column contains minimum values and second column contains
    maximum values.</p></td>
    </tr>
    <tr>
      <th>par.size</th>
      <td><p>a matrix of the bounds of the parameters used in <code>size.abc</code>. The row
    names of <code>par.size</code> provide the parameter names used in ABC calculation
    and output. First column contains minimum values and second column contains
    maximum values.</p></td>
    </tr>
    <tr>
      <th>constr</th>
      <td><p>constraints that must be set on parameter values, i.e., relationships that must
    be met when drawing the values in prior distributions. It must be a vector of 
    character strings each including an operator relating some of the parameters.
    The names of parameters must be consistent with those used in <code>par.filt</code>,
    <code>par.migr</code> and <code>par.size</code>. Default is <code>NULL</code> (no constraint).</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>should the summary statistics be scaled. Default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>dim.pca</th>
      <td><p>gives a number of independent dimensions to calculate from the simulated summary statistics, 
    by performing Principal Component Analysis (PCA). Default is <code>NULL</code>, in which case 
    no PCA is performed. 
    If <code>svd = T</code>, Singular Value Decomposition (SVD) will be performed instead of PCA.</p></td>
    </tr>
    <tr>
      <th>svd</th>
      <td><p>indicates if Singular Value Decomposition (SVD) must be performed to get the basic 
    dimensions requested in <code>dim.pca</code>. Will be ignored if <code>dim.pca = NULL</code>.</p></td>
    </tr>
    <tr>
      <th>theta.max</th>
      <td><p>if <code>pool = NULL</code>, regional abundances will be simulated following a
    log-series distribution. The function will estimate the <code>theta</code>
    parameter of this distribution. <code>theta.max</code> then provides the upper
    bound for this estimation.</p></td>
    </tr>
    <tr>
      <th>nb.samp</th>
      <td><p>the number of parameter values to be sampled in ABC calculation. Random
   values of parameters of environmental filtering (see <code>filt.abc</code> and
   <code>params</code>) and of migration (denoted as <code>m</code>) are drawn from a
   uniform distribution between minimum and maximum values provided in
   <code>params</code> (and between 0 and 1 for m).</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>boolean. If <code>parallel = TRUE</code>, the function will perform parallel
   processing using the <code>parLapply()</code> function of
   package <code>parallel</code>. Default is <code>parallel = FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>nb.core</th>
      <td><p>number of cores to be used in parallel computation if <code>parallel = TRUE</code>. 
   If <code>NULL</code> (default), all the cores minus 1 are used.
   If <code>1</code>, only one core is used (i.e., no parallel computing).</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>the tolerance value used in ABC estimation (see help in
    <code>abc()</code> function of package <code>abc</code> for further
    information). Default is <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>pkg</th>
      <td><p>packages needed for calculation of <code>filt.abc</code> and/or <code>f.sumstats</code>.</p></td>
    </tr>
    <tr>
      <th>J</th>
      <td><p>local community size(s). There must be several values when multi is <code>seqcom</code> or <code>tab</code>.</p></td>
    </tr>
    <tr>
      <th>nb.com</th>
      <td><p>number of communities.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>the type of algorithm to be used in EasyABC. Can be either "standard" (using package abc, default)" "seq" (sequential), "mcmc" or "annealing". Three later options are based on the EasyABC package.</p></td>
    </tr>
    <tr>
      <th>method.seq</th>
      <td><p>when type = "seq", gives the algorithm for sequential sampling scheme, which is passed to <code>
    ABC_sequential</code>. Can be "Lenormand" (Default), "Drovandi", "Delmoral", "Beaumont" or "Emulation".</p></td>
    </tr>
    <tr>
      <th>method.mcmc</th>
      <td><p>when type = "mcmc", gives the algorithm for MCMC sampling scheme, which is passed to <code>
    ABC_mcmc</code>. Can be "Marjoram_original"(Default), "Marjoram" or "Wegmann". The method "Marjoram_original" cannot      be used with multiple cores.</p></td>
    </tr>
    <tr>
      <th>method.abc</th>
      <td><p>the method to be used in ABC estimation (see help on
    <code>abc()</code> function  of package <code>abc</code> for further
    information). Can be "rejection", "loclinear", "neuralnet" or "ridge". Default is "rejection".</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>a positive number between 0 and 1 (strictly) used when performing sequential ABC method. <code>alpha</code>     is the proportion of particles rejected at each step in the algorithm "Drovandi". This is the             proportion of particles kept at each step in the algorithms "Delmoral", "Lenormand" and "Emulation".      Default value is 0.5</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>coalesc_abc()</code> performs ABC estimation for one (if <code>multi = "single"</code>,
default) or several communities (if <code>multi = "tab" or "seqcom"</code>) related to the same
regional pool. If <code>type = "standard"</code>, it performs simulations with parameter values randomly drawn in priori distributions. With other options in <code>type</code>, the function uses optimization algorithms implemented in the package <code>EasyABC</code>.</p>
<p>To assess environmental filtering, a filtering function must be defined in <code>filt.abc</code>. It should take two arguments, the first is a trait value of a candidate immigrant, the second is a vector including the parameter values of the filtering function. See examples below for further information on usage.
An important point is that in many cases the function might be vectorized, that is, it can provide a vector of filtering probabilities for a vector of trait values given in first argument. In this case the user should set <code>filt.vect = T</code>, which will significantly accelerate simulations.</p>
<p><code>coalesc_abc_std()</code> performs simulations as with the option <code>type = "standard"</code>.</p>
<p><code>do.simul.coalesc()</code> provides the simulated communities used in ABC estimation.
<code>generate_prior()</code> draws parameter values from the prior distributions defined with <code>params</code>,<code>par.filt</code> and/or <code>par.size</code>.
<code>initial_checks()</code> performs initial checks of the input arguments of <code>coalesc_abc</code> and <code>coalesc_abc_std</code>. It provides informative error and warning messages when needed.
The three functions are not intended to be used directly.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p></p>
<dt>par</dt><dd><p>parameter values used in simulations.</p></dd>
  <dt>obs</dt><dd><p>observed summary statistics.</p></dd>
  <dt>obs.scaled</dt><dd><p>observed summary statistics standardized according to the mean and standard
    deviation of simulated values.</p></dd>
  <dt>ss</dt><dd><p>standardized summary statistics of the communities simulated with parameter
    values listed in <code>par</code>.</p></dd>
  <dt>ss.scale</dt><dd><p>data frame including the mean and the standard deviation used for standardization of  
    observed and summary statistics.</p></dd>
  <dt>abc</dt><dd><p>a single (if <code>multi = FALSE</code>, default) or a list of abc objects
    including ABC estimation information for each community provided in input
    (<code>comm.obs</code>). It is of class <code>abc</code> for <code>type="standard"</code> and of class <code>EasyABC</code> otherwise.</p></dd>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>abc()</code> in <code>abc</code> package,
 <code>parLapply()</code> in <code>parallel</code> package.</p></div>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Jabot, F., and J. Chave. 2009. Inferring the parameters of the neutral theory
  of biodiversity using phylogenetic information and implications for tropical
  forests. Ecology Letters 12:239-248.</p>
<p>Csillery, K., M. G. B. Blum, O. E. Gaggiotti, and O. Francois. 2010.
  Approximate Bayesian computation (ABC) in practice. Trends in Ecology &amp;
  Evolution 25:410-418.</p>
<p>Csillery, K., O. Francois, and M. G. Blum. 2012. abc: an R package for
  Approximate Bayesian Computation (ABC). Methods in Ecology and Evolution
  3:475-479.</p>  
<p>Jabot, F., T. Faure, and N. Dumoulin 2013. EasyABC: performing efficient
  approximate Bayesian computation sampling schemes using R. Methods in 
  Ecology and Evolution 4:684-687.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># 1/ Analysis of community assembly in a single community</span>

<span class='co'># Trait-dependent filtering function</span>
<span class='no'>filt_gaussian</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>t</span>, <span class='no'>par</span>) <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(-(<span class='no'>t</span> - <span class='no'>par</span>[<span class='fl'>1</span>])^<span class='fl'>2</span>/(<span class='fl'>2</span>*<span class='no'>par</span>[<span class='fl'>2</span>]^<span class='fl'>2</span>))

<span class='co'># Definition of parameters of this function and their range</span>
<span class='no'>par.range</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.05</span>, <span class='fl'>1</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/row.names.html'>row.names</a></span>(<span class='no'>par.range</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"topt"</span>, <span class='st'>"sigmaopt"</span>)

<span class='co'># Basic summary statistics describing local community composition</span>
<span class='no'>f.sumstats</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>com</span>) <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='kw'>dimnames</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"cwm"</span>, <span class='st'>"cwv"</span>, <span class='st'>"cws"</span>,
                                                  <span class='st'>"cwk"</span>, <span class='st'>"S"</span>, <span class='st'>"Es"</span>)),
                                  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>com</span>[,<span class='fl'>3</span>]), <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span>(<span class='no'>com</span>[,<span class='fl'>3</span>]),
                                    <span class='kw pkg'>e1071</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/e1071/man/skewness.html'>skewness</a></span>(<span class='no'>com</span>[,<span class='fl'>3</span>]),
                                    <span class='kw pkg'>e1071</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/e1071/man/kurtosis.html'>kurtosis</a></span>(<span class='no'>com</span>[,<span class='fl'>3</span>]),
                                    <span class='kw pkg'>vegan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vegan/man/diversity.html'>specnumber</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='no'>com</span>[,<span class='fl'>2</span>])),
                                    <span class='kw pkg'>vegan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vegan/man/diversity.html'>diversity</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='no'>com</span>[,<span class='fl'>2</span>]))))

<span class='co'># An observed community is simulated with known parameter values</span>
<span class='no'>comm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>400</span>, <span class='kw'>m</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='fl'>50</span>,
                <span class='kw'>filt</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian</span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.2</span>, <span class='fl'>0.1</span>)))

<span class='co'># ABC estimation of the parameters of filtering and migration based on observed </span>
<span class='co'># community composition </span>
<span class='co'># Number of values to sample in prior distributions</span>
<span class='no'>nb.samp</span> <span class='kw'>&lt;-</span> <span class='fl'>1000</span> <span class='co'># Should be large</span>
<span class='co'>## Warning: this function may take a while</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>res.single</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>comm</span>$<span class='no'>com</span>, <span class='no'>comm</span>$<span class='no'>pool</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='no'>f.sumstats</span>,
                   <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='no'>filt_gaussian</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='no'>par.range</span>,
                   <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='no'>nb.samp</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                   <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"e1071"</span>,<span class='st'>"vegan"</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>))
<span class='co'># If the filtering function can be applied directly to a vector of trait values,</span>
<span class='co'># it is strongly recommended to set "filt.vect = T"</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>res.single</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>comm</span>$<span class='no'>com</span>, <span class='no'>comm</span>$<span class='no'>pool</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='no'>f.sumstats</span>,
                   <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='no'>filt_gaussian</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='no'>par.range</span>,
                   <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='no'>nb.samp</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                   <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"e1071"</span>,<span class='st'>"vegan"</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>))

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>res.single</span>$<span class='no'>abc</span>, <span class='kw'>param</span> <span class='kw'>=</span> <span class='no'>res.single</span>$<span class='no'>par</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>res.single</span>$<span class='no'>abc</span>)

<span class='co'># Cross validation</span>
<span class='co'>## Warning: this function is slow</span>
<span class='no'>res.single</span>$<span class='no'>cv</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>abc</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/abc/man/cv4abc.html'>cv4abc</a></span>(<span class='kw'>param</span> <span class='kw'>=</span> <span class='no'>res.single</span>$<span class='no'>par</span>, <span class='kw'>sumstat</span> <span class='kw'>=</span> <span class='no'>res.single</span>$<span class='no'>ss</span>, <span class='kw'>nval</span> <span class='kw'>=</span> <span class='fl'>100</span>,
                      <span class='kw'>tols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.01</span>, <span class='fl'>0.1</span>, <span class='fl'>1</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>res.single</span>$<span class='no'>cv</span>)

<span class='co'># Alternative option using a MCMC sampling approach</span>
<span class='no'>res.single2</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>comm</span>$<span class='no'>com</span>, <span class='no'>comm</span>$<span class='no'>pool</span>, <span class='kw'>f.sumstats</span><span class='kw'>=</span><span class='no'>f.sumstats</span>, <span class='kw'>filt.abc</span><span class='kw'>=</span><span class='no'>filt_gaussian</span>,
<span class='kw'>par.filt</span><span class='kw'>=</span><span class='no'>par.range</span>, <span class='kw'>nb.samp</span><span class='kw'>=</span><span class='no'>nb.samp</span>/<span class='fl'>10</span>, <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>0.1</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mcmc"</span>)

<span class='co'># 2/ Analysis of community assembly in multiple communities with a common pool of </span>
<span class='co'># immigrants</span>

<span class='co'># When the input is a site-species matrix, use argument multi="tab"</span>

<span class='co'># 2.1/ Environment-dependent environmental filtering</span>

<span class='co'># The variation of optimal trait values can depend on environmental variation across communities</span>
<span class='no'>filt_gaussian_env</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>t</span>, <span class='no'>par</span>, <span class='no'>env</span>) <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(-(<span class='no'>t</span>-<span class='no'>par</span>[<span class='fl'>1</span>]*<span class='no'>env</span>+<span class='no'>par</span>[<span class='fl'>2</span>])^<span class='fl'>2</span>/(<span class='fl'>2</span>*<span class='no'>par</span>[<span class='fl'>3</span>]^<span class='fl'>2</span>))
<span class='co'># Vector of environmental conditions across communities</span>
<span class='no'>env1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fl'>20</span>))

<span class='co'># Simulate a set of 20 communities with varying environmental filtering in</span>
<span class='co'># different environmental conditions</span>
<span class='co'># A common source pool of immigrants</span>
<span class='no'>pool</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>10000</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='fl'>50</span>)$<span class='no'>com</span>
<span class='no'>meta1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>()
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>)
  <span class='no'>meta1</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>400</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='no'>pool</span>, <span class='kw'>m</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                <span class='kw'>filt</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian_env</span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.2</span>, <span class='fl'>0.1</span>), <span class='no'>env1</span>[<span class='no'>i</span>,]))
<span class='co'># Build a species-by-site table</span>
<span class='no'>tab1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>20</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>pool</span>$<span class='no'>sp</span>)))
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>) {
  <span class='no'>compo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='no'>meta1</span><span class='kw'>[[</span><span class='no'>i</span>]]$<span class='no'>com</span>$<span class='no'>sp</span>)
  <span class='no'>tab1</span>[<span class='no'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>compo</span>))] <span class='kw'>&lt;-</span> <span class='no'>compo</span>
}
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab1</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>tab1</span>))
<span class='no'>tab1</span> <span class='kw'>&lt;-</span> <span class='no'>tab1</span>[, <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span>(<span class='no'>tab1</span>)<span class='kw'>!=</span><span class='fl'>0</span>]

<span class='co'># Definition of parameters and their range</span>
<span class='co'># We will estimate the slope a and intercept b of the linear relationship between </span>
<span class='co'># optimal trait values and environmental conditions</span>
<span class='no'>par.range</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>1</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.05</span>, <span class='fl'>1</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/row.names.html'>row.names</a></span>(<span class='no'>par.range</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"sigmaopt"</span>)

<span class='co'># Basic summary statistics</span>
<span class='co'># The function will provide trait-based statistics and taxonomic diversity in</span>
<span class='co'># each community</span>
<span class='no'>f.sumstats</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>tab</span>, <span class='no'>traits</span>) <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='kw'>dimnames</span><span class='kw'>=</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"cwm"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)), <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"cwv"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"cws"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)), <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"cwk"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"S"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)), <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"Es"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"beta"</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)),<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>tab</span>)))),
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='kw pkg'>Weighted.Desc.Stat</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Weighted.Desc.Stat/man/w.mean.html'>w.mean</a></span>(<span class='no'>traits</span>[<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab</span>),], <span class='no'>x</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='kw pkg'>Weighted.Desc.Stat</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Weighted.Desc.Stat/man/w.var.html'>w.var</a></span>(<span class='no'>traits</span>[<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab</span>),], <span class='no'>x</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='kw pkg'>Weighted.Desc.Stat</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Weighted.Desc.Stat/man/w.skewness.html'>w.skewness</a></span>(<span class='no'>traits</span>[<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab</span>),], <span class='no'>x</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='kw pkg'>Weighted.Desc.Stat</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Weighted.Desc.Stat/man/w.kurtosis.html'>w.kurtosis</a></span>(<span class='no'>traits</span>[<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab</span>),], <span class='no'>x</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='no'>x</span><span class='kw'>!=</span><span class='fl'>0</span>)),
  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>tab</span>, <span class='fl'>1</span>, <span class='kw pkg'>vegan</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/pkg/vegan/man/diversity.html'>diversity</a></span>),
  <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='kw pkg'>vegan</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vegan/man/betadiver.html'>betadiver</a></span>(<span class='no'>tab</span>,<span class='st'>"w"</span>)))))

<span class='co'># ABC estimation of the parameters of trait-environment relationship and of migration,</span>
<span class='co'># based on observed community composition </span>
<span class='co'>## Warning: this function may take a while</span>
<span class='no'>res.tab1</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>tab1</span>, <span class='no'>pool</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"tab"</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='no'>f.sumstats</span>,
                   <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='no'>filt_gaussian_env</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='no'>par.range</span>,
                   <span class='kw'>add</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='no'>env1</span>,
                   <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='no'>nb.samp</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                   <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"vegan"</span>,<span class='st'>"Weighted.Desc.Stat"</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>)

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>res.tab1</span>$<span class='no'>abc</span>, <span class='kw'>param</span><span class='kw'>=</span><span class='no'>res.tab1</span>$<span class='no'>par</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>res.tab1</span>$<span class='no'>abc</span>)

<span class='co'># 2.2/ Environment-dependent environmental filtering and immigration</span>

<span class='co'># In this case, the migration rate depends of another environmental variable</span>
<span class='co'># representing, e.g., community isolation</span>
<span class='co'># There will be two environmental variables used for parameter inference, one conditioning</span>
<span class='co'># environmental filtering, and the other conditioning migration</span>
<span class='no'>env2</span> <span class='kw'>&lt;-</span>  <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fl'>20</span>))
<span class='no'>env</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='no'>env1</span>, <span class='no'>env2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>env</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"env1"</span>, <span class='st'>"env2"</span>)
<span class='co'># Migration depends on environmental conditions following some linear relationship</span>
<span class='no'>migr_env</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>par</span>, <span class='no'>env</span>) (<span class='no'>par</span>[<span class='fl'>2</span>]-<span class='no'>par</span>[<span class='fl'>1</span>])*<span class='no'>env</span>+<span class='no'>par</span>[<span class='fl'>1</span>]

<span class='co'># Simulate a set of 20 communities with environment-dependent environmental filtering </span>
<span class='co'># and immigration</span>
<span class='no'>meta2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>()
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>)
  <span class='no'>meta2</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>400</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='no'>pool</span>, <span class='kw'>m</span> <span class='kw'>=</span> <span class='fu'>migr_env</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.25</span>,<span class='fl'>0.75</span>), <span class='no'>env</span>[<span class='no'>i</span>,<span class='fl'>2</span>]),
                <span class='kw'>filt</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian_env</span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.2</span>, <span class='fl'>0.1</span>), <span class='no'>env</span>[<span class='no'>i</span>,<span class='fl'>1</span>]))
<span class='co'># Build a species-by-site table</span>
<span class='no'>tab2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>20</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>pool</span>$<span class='no'>sp</span>)))
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>) {
  <span class='no'>compo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='no'>meta2</span><span class='kw'>[[</span><span class='no'>i</span>]]$<span class='no'>com</span>$<span class='no'>sp</span>)
  <span class='no'>tab2</span>[<span class='no'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>compo</span>))] <span class='kw'>&lt;-</span> <span class='no'>compo</span>
}
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab2</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>tab2</span>))
<span class='no'>tab2</span> <span class='kw'>&lt;-</span> <span class='no'>tab2</span>[, <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span>(<span class='no'>tab2</span>)<span class='kw'>!=</span><span class='fl'>0</span>]

<span class='co'># Definition of parameters and their range</span>
<span class='co'># We will estimate the slope a and intercept b of the linear relationship between </span>
<span class='co'># optimal trait values and environmental variable 1, and slope c and intercept d in the</span>
<span class='co'># logistic function determining the variation of migration rate with environmental variable 2</span>
<span class='no'>par.filt.range</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>1</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.05</span>, <span class='fl'>1</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/row.names.html'>row.names</a></span>(<span class='no'>par.filt.range</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"sigmaopt"</span>)
<span class='no'>par.migr.range</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/row.names.html'>row.names</a></span>(<span class='no'>par.migr.range</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"c"</span>, <span class='st'>"d"</span>)

<span class='co'># ABC estimation of the parameters of trait-environment and migration-environment </span>
<span class='co'># relationships, based on observed community composition </span>
<span class='co'>## Warning: this function may take a while</span>
<span class='no'>nb.samp</span> <span class='kw'>&lt;-</span> <span class='fl'>200</span>
<span class='no'>res.tab2</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>tab2</span>, <span class='no'>pool</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"tab"</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='no'>f.sumstats</span>,
                   <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>par</span>, <span class='no'>env</span>) <span class='fu'>filt_gaussian_env</span>(<span class='no'>x</span>, <span class='no'>par</span>, <span class='no'>env</span>[<span class='fl'>1</span>]),
                   <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>migr.abc</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>par</span>, <span class='no'>env</span>) <span class='fu'>migr_env</span>(<span class='no'>par</span>, <span class='no'>env</span>[<span class='fl'>2</span>]),
                   <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='no'>par.filt.range</span>, <span class='kw'>par.migr</span> <span class='kw'>=</span> <span class='no'>par.migr.range</span>,
                   <span class='kw'>add</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>var.add</span> <span class='kw'>=</span> <span class='no'>env</span>,
                   <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='no'>nb.samp</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                   <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"e1071"</span>,<span class='st'>"vegan"</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>)

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>res.tab2</span>$<span class='no'>abc</span>, <span class='kw'>param</span><span class='kw'>=</span><span class='no'>res.tab2</span>$<span class='no'>par</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>res.tab2</span>$<span class='no'>abc</span>)

<span class='co'># Check result consistency</span>
<span class='no'>comm</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>coeff</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>res.tab2</span>$<span class='no'>abc</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>pool</span>$<span class='no'>tra</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian_env</span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.2</span>, <span class='fl'>0.1</span>), <span class='no'>env</span>[<span class='no'>comm</span>,<span class='fl'>1</span>])),
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>pool</span>$<span class='no'>tra</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian_env</span>(<span class='no'>x</span>, <span class='no'>coeff</span>[<span class='fl'>3</span>,<span class='fl'>1</span>:<span class='fl'>3</span>], <span class='no'>env</span>[<span class='no'>comm</span>,<span class='fl'>1</span>]))),
<span class='kw'>xlab</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"Expected filter value in community "</span>, <span class='no'>comm</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>" "</span>), <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"Estimated filter value"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>env</span>[,<span class='fl'>2</span>], <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>migr_env</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.25</span>, <span class='fl'>0.75</span>), <span class='no'>x</span>)),
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>env</span>[,<span class='fl'>2</span>], <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>migr_env</span>(<span class='no'>coeff</span>[<span class='fl'>3</span>,<span class='fl'>4</span>:<span class='fl'>5</span>], <span class='no'>x</span>))),
<span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"Expected migration value"</span>, <span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"Estimated migration value"</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>)

<span class='co'># 3/ Distinct pools of migrants across communities</span>

<span class='co'># The immigrants can be drawn from distinct pools for each community, to represent a local context.</span>
<span class='co'># In this case, the pool argument sent to coalesc_abc must be a list of the local pools.</span>

<span class='co'># Simulate several communities with distinct pools and same environmental filter</span>
<span class='no'>pool.loc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>()
<span class='no'>meta3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>()
<span class='no'>theta</span> <span class='kw'>&lt;-</span> <span class='fl'>2.5</span>*(<span class='fl'>1</span>:<span class='fl'>20</span>) <span class='co'># The pools differ in diversity</span>
<span class='co'># We first define a baseline pool of immigrants common to all communities</span>
<span class='no'>baseline</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>10000</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='fl'>25</span>)$<span class='no'>com</span>
<span class='no'>baseline</span>$<span class='no'>sp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fl'>0</span>, <span class='no'>baseline</span>$<span class='no'>sp</span>, <span class='kw'>sep</span> <span class='kw'>=</span> <span class='st'>"_"</span>)
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>)
{
  <span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>10000</span>, <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>theta</span>[<span class='no'>i</span>])$<span class='no'>com</span>
  <span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]]$<span class='no'>sp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='no'>i</span>, <span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]]$<span class='no'>sp</span>, <span class='kw'>sep</span> <span class='kw'>=</span> <span class='st'>"_"</span>)
  <span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]], <span class='no'>baseline</span>)
  <span class='no'>meta3</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='coalesc.html'>coalesc</a></span>(<span class='kw'>J</span> <span class='kw'>=</span> <span class='fl'>400</span>, <span class='kw'>pool</span> <span class='kw'>=</span> <span class='no'>pool.loc</span><span class='kw'>[[</span><span class='no'>i</span>]], <span class='kw'>m</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                <span class='kw'>filt</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>filt_gaussian</span>(<span class='no'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.25</span>, <span class='fl'>0.1</span>)))
}
<span class='co'># Build a species-by-site table</span>
<span class='no'>tab3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>20</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span>(<span class='no'>rbind</span>, <span class='no'>pool.loc</span>)[,<span class='fl'>2</span>]))))
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tab3</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span>(<span class='no'>rbind</span>, <span class='no'>pool.loc</span>)[,<span class='fl'>2</span>])
<span class='kw'>for</span>(<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>20</span>) {
  <span class='no'>compo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span>(<span class='no'>meta3</span><span class='kw'>[[</span><span class='no'>i</span>]]$<span class='no'>com</span>$<span class='no'>sp</span>)
  <span class='no'>tab3</span>[<span class='no'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>compo</span>)] <span class='kw'>&lt;-</span> <span class='no'>compo</span>
}
<span class='no'>tab3</span> <span class='kw'>&lt;-</span> <span class='no'>tab3</span>[, <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span>(<span class='no'>tab3</span>)<span class='kw'>!=</span><span class='fl'>0</span>]

<span class='co'># ABC estimation of the parameters of trait-environment and migration-environment </span>
<span class='co'># relationships, based on observed community composition </span>
<span class='co'>## Warning: this function may take a while</span>
<span class='no'>par.range</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>1</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.05</span>, <span class='fl'>1</span>)))
<span class='fu'><a href='https://rdrr.io/r/base/row.names.html'>row.names</a></span>(<span class='no'>par.range</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"topt"</span>, <span class='st'>"sigmaopt"</span>)
<span class='no'>res.tab3</span> <span class='kw'>&lt;-</span> <span class='fu'>coalesc_abc</span>(<span class='no'>tab3</span>, <span class='no'>pool.loc</span>, <span class='kw'>multi</span> <span class='kw'>=</span> <span class='st'>"tab"</span>, <span class='kw'>f.sumstats</span> <span class='kw'>=</span> <span class='no'>f.sumstats</span>,
                   <span class='kw'>filt.abc</span> <span class='kw'>=</span> <span class='no'>filt_gaussian</span>, <span class='kw'>filt.vect</span> <span class='kw'>=</span> <span class='no'>T</span>,
                   <span class='kw'>par.filt</span> <span class='kw'>=</span> <span class='no'>par.range</span>,
                   <span class='kw'>nb.samp</span> <span class='kw'>=</span> <span class='no'>nb.samp</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
                   <span class='kw'>pkg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"e1071"</span>,<span class='st'>"vegan"</span>), <span class='kw'>method.abc</span> <span class='kw'>=</span> <span class='st'>"neuralnet"</span>)

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>res.tab3</span>$<span class='no'>abc</span>, <span class='kw'>param</span><span class='kw'>=</span><span class='no'>res.tab3</span>$<span class='no'>par</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='no'>res.tab3</span>$<span class='no'>abc</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by François Munoz, Matthias Grenié, Pierre Denelle, Elizabeth Barthelemy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


